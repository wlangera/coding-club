---
title: "Read and preprocess geese data"
<<<<<<< HEAD
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  chunk_output_type: console
---

=======
author: 
- "Damiano Oldoni"
- "Coauthor 1"
- "Coauthor 2"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    df_print: paged
---


# Setup 

>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<<<<<<< HEAD
# CHALLENGE 1

Convert the code below to a Rmd document called `1_geese_read_data.Rmd` and make an html version of it.  
  
title : "Read and preprocess geese data"


## Setup

Load libraries:

```{r, message=FALSE, warning=FALSE}
library(tidyverse)    # to do datascience
library(geepack)      # to do modelling
library(INBOtheme)    # to apply INBO style to graphs
library(sf)           # to work with geospatial vector data
library(leaflet)      # to make dynamic maps
library(htmltools)    # to make nice html labels for dynamic maps
```

## Introduction
=======
Load packages:

```{r load-pkgs, message=FALSE, warning=FALSE}
library(tidyverse)    # to do datascience
```

Notice that all the other packages are for challenge 2, you don't need to load them in this document.

# Introduction
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56

In this document we will:

1. read geese data
2. explore data
3. preprocess data

<<<<<<< HEAD
## Read data

Read catches and counts of geese in Flanders:

```{r}
catch_fl <- read_csv(here::here("data/20221213/20221213_geese_counts.txt"),
=======

# Read data

Read catches and counts of geese in Flanders:

Set _Global Options_ -> _RMarkdown pane_ -> _Evaluate chunks in directory_: **Project**. In this way RMarkdown knows that he has to read paths starting from the root folder, i.e. the folder containing `coding-club.Rproj`.

```{r read-data}
catch_fl <- read_csv("./data/20221213/20221213_geese_counts.txt",
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
                     na = "NA",
                     col_types = cols(
                       province = col_character(),
                       location = col_character(),
                       year = col_double(),
                       latinName = col_character(),
                       commonName = col_character(),
                       counts = col_double(),
                       catched = col_double(),
                       adult = col_double(),
                       pulli = col_double(),
                       not_catched = col_double()
                     ))
```

<<<<<<< HEAD

Number of catch data:

```{r}
=======
If you don't want to change this global option, fine! Then, you can find interesting to work with package [`here`](https://www.rdocumentation.org/packages/here/versions/1.0.1) to do the same without changing anything:

```{r read-againi-with-here}
library(here) # install it first if not yet done
path_catch_file <- here("data", "20221213", "20221213_geese_counts.txt")
catch_fl <- read_csv(path_catch_file,
                     na = "NA",
                     col_types = cols(
                       province = col_character(),
                       location = col_character(),
                       year = col_double(),
                       latinName = col_character(),
                       commonName = col_character(),
                       counts = col_double(),
                       catched = col_double(),
                       adult = col_double(),
                       pulli = col_double(),
                       not_catched = col_double()
                     ))
```

The nice thing of using `here` is that your paths will work always, no matter you run your code manually or you knit it.

Number of geese catch data:

```{r nrows}
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
nrow(catch_fl)
```

Preview:

<<<<<<< HEAD
```{r}
head(catch_fl, n = 30)
```


## Explore data

### Taxonomic information

Species present:

```{r}
=======
```{r preview-data}
head(catch_fl, n = 10)
```


# Explore data

## Taxonomic information

Species present:

```{r species}
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
catch_fl %>% distinct(latinName, commonName)
```


<<<<<<< HEAD
### Geographic information

Data are geographically grouped by province and municipality (`location`):

```{r}
catch_fl %>% distinct(province, location)
```



### Temporal information

The data are temporally defined at year level:

```{r}
=======
## Geographic information

Data are geographically grouped by province and municipality (`location`):

```{r get-provinces&municipalities}
catch_fl %>% distinct(province, location)
```

## Temporal information

The data are temporally defined at year level:

```{r get-years}
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
years <- catch_fl %>% distinct(year) %>% pull()
```

from:

<<<<<<< HEAD
```{r}
=======
```{r min-years}
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
min(years)
```

to:

<<<<<<< HEAD
```{r}
max(years)
```


## Preprocess data

Data not linked to any `province` or `location` (`NAs`) will be removed.  
  
Number of rows removed:

```{r, echo=FALSE}
catch_fl %>%
  filter(is.na(province) | is.na(location)) %>%
  nrow
=======
```{r max-years}
max(years)
```

# Preprocess data

Data not linked to any `province` or `location` (`NAs`) will be removed. 

Number of rows removed:

```{r  remove-NAs,  echo=FALSE}
catch_fl %>% filter(is.na(province) | is.na(location)) %>% nrow
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
```

Final dataset:

<<<<<<< HEAD
```{r, echo=FALSE}
=======
```{r  show-cleaned-data, echo=FALSE}
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
catch_fl <- catch_fl %>% filter(!is.na(province) & !is.na(location))
catch_fl
```

<<<<<<< HEAD

## Write out dataset

```{r}
write.csv(catch_fl, 
          here::here("data/20221213/20221213_geese_counts_processed.txt"))
```

=======
## Save cleaned data

This section is added as part of the solution of challenge 2. By saving the cleaned dataframe at the end of this document we can read it at the beginning of the second R Markdown document as input for modelling and plotting.

```{r save-cleaned-data}
write_csv(x = catch_fl, 
          file = here("data",
                      "20221213",
                      "20221213_geese_counts_cleaned.txt"),
          na = "")
```
>>>>>>> eca24f17bc7362393f9ae594cb2877cc74c6ec56
